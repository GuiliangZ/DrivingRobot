# This guide show how to setup CAN Kvaser setup so when you plug in the Kvaser Leaf v2, the computer can recognize it as "can0, can1, .." channels, so you can just use socket-can python package in your code to read can data. 


# Most importantly, need to install the socketcan_kvaser_driver properly. Need to download this package in the official website: socketcan_kvaser_drivers_1_20_867.tar.gz. Also need to download linuxcan: linuxcan_5_49_188.tar.gz

Most importantly, make sure there's no "virtualcan", if you still have virtualcan, it won't regonize it as "can1, can2.."(socketcan): 
sudo modprobe -r kvaser_virtual  # and any other linux-can modules


In linuxcan folder, go to "common" and run installscript.sh and go to "leaf" and run installscript.sh

In the socketcan_kvaser_driver, 
git clone https://github.com/kvaser/linuxcan socketcan_kvaser_drivers
cd socketcan_kvaser_drivers/kernel/drivers/net/can/usb/kvaser_usb
make -C /lib/modules/$(uname -r)/build M=$(pwd) modules
sudo mkdir -p /lib/modules/$(uname -r)/updates
sudo make -C /lib/modules/$(uname -r)/build M=$(pwd) \
     INSTALL_MOD_DIR=updates modules_install
sudo depmod -a
sudo modprobe kvaser_usb

sudo modprobe can        # CAN core
sudo modprobe can_raw    # RAW sockets
sudo modprobe kvaser_usb # Kvaser Leaf / USBcan family

lsmod | grep kvaser

verify:
sudo modprobe kvaser_usb   # already done, but harmless to repeat
sudo dmesg -w | grep -i kvaser &
# now unplug → re-plug the Leaf Light


Not using kvaser canlib



ketcan_kvaser_drivers:
# 1) grab the sources
git clone https://github.com/AD-EYE/socketcan_kvaser_drivers.git
cd socketcan_kvaser_drivers
# 2) make sure headers & build tools are present
sudo apt-get install --yes build-essential linux-headers-$(uname -r)
# 4) build & install the module
make
sudo make install      # installs into /lib/modules/$(uname -r)/updates
sudo depmod -a         # refresh module dependency tree

sudo modprobe kvaser_usb           # load the module
dmesg | tail                       # should show “Kvaser Leaf Light v2 … registered”
lsmod | grep kvaser_usb            # make sure it’s really loaded
ip -details link show | grep -A2 can


sudo ip link set can1 down                    # defensive
sudo ip link set can1 type can bitrate 500000
sudo ip link set can1 up
candump -td can1                              # or cansniffer, cangen, etc.

